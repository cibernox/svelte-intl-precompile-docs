<script lang="ts">
  import { goto } from '$app/navigation';
  import { page } from '$app/stores';  
  import { locale } from 'svelte-intl-precompile';
  import { availableLocales } from '$locales';
  import { extractLanguageFromPath, localeRegex } from './+layout';

  $: lang = extractLanguageFromPath($page.url.pathname);
  $: {
    if ($locale !== lang) {
      $locale = lang;
    }
  }
  function flagFor(lang) {
    return `/flags/${lang}.svg`;
  }

  function setLocale(code) {
    if ($page.url.pathname === '/') {
      goto('/' + code, { noScroll: true });
    } else {
      let newPath = $page.url.pathname.replace(localeRegex, '/' + code + '$2');
      if (newPath === $page.url.pathname && !localeRegex.exec($page.url.pathname)) {
        newPath = `/${code}${$page.url.pathname}`
      }
      goto(newPath, { noScroll: true })
    }
  }
</script>

<header class="fixed flex justify-between content-center bg-white shadow-lg w-screen h-14 px-8">
  <div class="flex items-center">
    <a href="/" class="-ml-8">
      <svg width="300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 4632 903">
        <path fill="#000" d="M1265.23 567.773v-26.228h52.45V410.407h-52.45V384.18h157.36v26.227h-52.45v131.138h52.45v26.228h-157.36Zm173.1 0V436.635h157.36v26.228h26.23v104.91h-52.45v-104.91h-78.69v104.91h-52.45Zm278.01 0v-104.91h-52.45v-26.228h52.45V384.18h52.46v52.455h52.45v26.228h-52.45v104.91h-52.46Zm146.87 0v-26.228h52.46V410.407h-26.23V384.18h78.68v157.365h52.46v26.228h-157.37Zm372.43 0V384.18h157.37v26.227h26.23v78.683h-26.23v26.227H2288.1v52.456h-52.46Zm52.46-78.683h78.68v-78.683h-78.68v78.683Zm225.56-26.227h26.22v26.227h-26.22v78.683h-52.46V436.635h52.46v26.228Zm104.91-26.228v26.228h-78.69v-26.228h78.69Zm41.96 131.138v-26.228h-26.23v-78.682h26.23v-26.228h131.14v26.228h26.23v52.454h-131.14v26.228h104.91v26.228h-131.14Zm26.23-78.683h78.68v-26.227h-78.68v26.227Zm173.1 78.683v-26.228h-26.23v-78.682h26.23v-26.228h157.36v26.228h-131.13v78.682h131.13v26.228h-157.36Zm199.33 0v-26.228h-26.23v-78.682h26.23v-26.228h131.14v26.228h26.22v78.682h-26.22v26.228h-131.14Zm26.23-26.228h78.68v-78.682h-78.68v78.682Zm146.87 26.228V436.635h157.36v26.228h26.23v104.91h-52.45v-104.91h-26.23v104.91h-52.46v-104.91h-26.22v104.91h-26.23ZM3431.62 594V436.635h157.36v26.228h26.23v52.454h-26.23v26.228h-104.91V594h-52.45Zm52.45-78.683h78.69v-52.454h-78.69v52.454Zm225.56-104.91V384.18h52.46v26.227h-52.46Zm-52.45 157.366v-26.228h52.45v-78.682h-26.23v-26.228h78.69v104.91h52.45v26.228h-157.36Zm199.32 0v-26.228h52.46V410.407h-26.23V384.18h78.68v157.365h52.46v26.228H3856.5Zm199.33 0v-26.228h-26.22v-78.682h26.22v-26.228h131.14v26.228h26.23v52.454h-131.14v26.228h104.91v26.228h-131.14Zm26.23-78.683h78.68v-26.227h-78.68v26.227Z"/>
        <path fill="#FF2A2A" d="M4281.39 567.773v-52.456h52.45v52.456h-52.45ZM658.562 512.359l28.266-102.515h42.469L677.969 562h-38.813l-51.328-152.156h42.469l28.265 102.515Zm156.797 52.453c-22.312 0-40.5-6.843-54.562-20.531-13.969-13.687-20.953-31.922-20.953-54.703v-3.937c0-15.282 2.953-28.922 8.859-40.922 5.906-12.094 14.25-21.375 25.031-27.844 10.875-6.563 23.25-9.844 37.125-9.844 20.813 0 37.172 6.563 49.079 19.688 12 13.125 18 31.734 18 55.828v16.594h-96.891c1.312 9.937 5.25 17.906 11.812 23.906 6.657 6 15.047 9 25.172 9 15.657 0 27.891-5.672 36.703-17.016l19.969 22.36c-6.094 8.625-14.344 15.375-24.75 20.25-10.406 4.781-21.937 7.171-34.594 7.171Zm-4.64-124.874c-8.063 0-14.625 2.718-19.688 8.156-4.969 5.437-8.156 13.218-9.562 23.344H838v-3.235c-.188-9-2.625-15.937-7.312-20.812-4.688-4.969-11.344-7.453-19.969-7.453ZM944.031 562H903.25V346h40.781v216Zm82.269-189.562v37.406h26.01v29.812h-26.01v75.938c0 5.625 1.08 9.656 3.23 12.094 2.16 2.437 6.28 3.656 12.38 3.656 4.5 0 8.48-.328 11.95-.985v30.797c-7.97 2.438-16.17 3.656-24.61 3.656-28.5 0-43.031-14.39-43.594-43.171v-81.985h-22.218v-29.812h22.218v-37.406h40.644Zm118.68 192.374c-22.31 0-40.5-6.843-54.56-20.531-13.97-13.687-20.95-31.922-20.95-54.703v-3.937c0-15.282 2.95-28.922 8.86-40.922 5.9-12.094 14.25-21.375 25.03-27.844 10.87-6.563 23.25-9.844 37.12-9.844 20.82 0 37.18 6.563 49.08 19.688 12 13.125 18 31.734 18 55.828v16.594h-96.89c1.31 9.937 5.25 17.906 11.81 23.906 6.66 6 15.05 9 25.18 9 15.65 0 27.89-5.672 36.7-17.016l19.97 22.36c-6.1 8.625-14.35 15.375-24.75 20.25-10.41 4.781-21.94 7.171-34.6 7.171Zm-4.64-124.874c-8.06 0-14.62 2.718-19.68 8.156-4.97 5.437-8.16 13.218-9.57 23.344h56.53v-3.235c-.18-9-2.62-15.937-7.31-20.812-4.69-4.969-11.34-7.453-19.97-7.453Zm-765.107 152.59c-44.173-7.029-79.689-40.065-88.276-82.111-4.746-23.238-.736-48.441 10.696-67.219l2.527-4.15-2.975-6.886c-16.912-39.142-6.342-84.704 25.697-110.765 7.429-6.043 92.478-59.927 101.099-64.052 14.903-7.132 28.67-9.871 46.552-9.263 12.905.439 18.969 1.492 30.402 5.28 35.954 11.911 63.126 41.872 70.436 77.663 4.746 23.238.735 48.441-10.697 67.219l-2.527 4.15 2.975 6.886c16.912 39.142 6.343 84.704-25.696 110.765-7.429 6.043-92.479 59.927-101.1 64.052-8.397 4.018-17.599 6.858-27.318 8.431-8.013 1.297-23.642 1.297-31.795 0Zm27.936-39.234c5.894-1.295 12.697-3.945 17.021-6.629 24.879-15.444 86.072-54.825 88.871-57.192 8.447-7.145 15.137-17.545 18.141-28.201 2.368-8.402 2.365-21.895-.007-30.229-9.638-33.853-44.344-53.939-78.259-45.293-7.57 1.929-13.035 4.816-31.887 16.841-9.107 5.809-17.658 11.02-19.003 11.581-2.898 1.208-9.674 1.338-12.605.241-12.308-4.607-16.611-19.606-8.11-28.272 3.745-3.819 85.003-55.526 88.98-56.622 6.295-1.734 14.176.705 18.628 5.764 3.401 3.865 4.686 7.311 4.664 12.503l-.02 4.48 3.416.908c8.572 2.278 23.722 9.901 31.588 15.893 1.894 1.444 3.68 2.625 3.969 2.625.898 0 3.661-10.391 4.458-16.765 2.373-18.97-6.312-39.706-22.242-53.102-18.315-15.402-43.397-19.46-65.521-10.6-4.581 1.834-.138-.896-51.545 31.684-38.861 24.63-41.785 26.632-48.052 32.896-7.563 7.561-11.668 14.467-14.508 24.407-2.378 8.325-2.375 21.822.007 30.187 9.638 33.852 44.343 53.939 78.258 45.293 7.54-1.921 12.978-4.792 31.955-16.868 9.144-5.819 17.695-11.028 19.003-11.577 2.836-1.188 9.628-1.307 12.537-.218 12.308 4.606 16.611 19.605 8.111 28.272-3.746 3.818-85.003 55.526-88.981 56.621-6.295 1.735-14.176-.704-18.628-5.763-3.401-3.865-4.686-7.311-4.663-12.503l.02-4.481-3.416-.907c-8.572-2.278-23.722-9.901-31.588-15.893-1.894-1.444-3.68-2.625-3.969-2.625-.898 0-3.661 10.391-4.458 16.765-2.971 23.753 11.233 49.21 34.013 60.958 14.061 7.252 28.553 9.177 43.822 5.821Z"/>
      </svg>    
    </a>
  </div>
  <div class="flex items-center">
    {#each availableLocales as locale}
    <button on:click={() => setLocale(locale)}>
      <img class="h-6 w-6 ml-2" src={flagFor(locale)} alt={locale}>
    </button>
    {/each}
    <a href={`/${lang}/docs/introduction`} class="m-2">Docs</a>
    <a href="https://github.com/cibernox/svelte-intl-precompile" class="h-6 w-6 m-2 fill-current">
      <svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg>
    </a>
  </div>
</header>
<main class="pt-14 font-body leading-relaxed font-light">
  <slot />
</main>
